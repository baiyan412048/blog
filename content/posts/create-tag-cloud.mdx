---
title: Tag cloud å¯¦ä½œ
description: å¯¦ä½œ Tag cloud çš„æ–¹å¼åŠéç¨‹ç´€éŒ„
date: '2023-10-04'
tags:
  - Next
  - DIY
---

è€ƒæ…®åˆ°çŸ­æœŸå…§æ–‡ç« æ•¸ä¸æœƒæœ‰å¤ªå¤šç¯‡ï¼Œä¹Ÿé‚„æ²’æœ‰æƒ³åˆ°å¦‚æœçœŸçš„è¦ä½¿ç”¨åˆ†é¡æœƒç”¨æ€æ¨£çš„æ–¹å¼ï¼Œ  
æ‰€ä»¥æš«ä»¥ `Tag` çš„æ–¹å¼å»åˆ†é¡ï¼Œæ–‡ç« æ•¸å°‘çš„æƒ…æ³æ‡‰è©²é‚„éå¾—å»ï¼Œ
ç´€éŒ„ä¸€ä¸‹æ€éº¼å¯¦ä½œ Tag cloud çš„åŠŸèƒ½ï¼Œé¡Œå¤–è©± : åˆ†é¡åœ¨ DIY çœŸå¹½é»˜ã€‚

## è§£æ±º Routes çš„å•é¡Œ

ç›®å‰æˆ‘å€‘ (æˆ‘èˆ‡æˆ‘) éƒ¨è½æ ¼æ˜¯ä½¿ç”¨ [SSG (Static Site Generation)](https://israynotarray.com/other/20210529/2519649612/) çš„æ¸²æŸ“æ–¹å¼ï¼Œ  
è€Œ `SSG` å®šç¾© `Routes` æ™‚éœ€è¦ä½¿ç”¨ [generateStaticParams](https://nextjs.org/docs/app/api-reference/functions/generate-static-params#single-dynamic-segment) [^1] æŠŠæ‰€æœ‰ Routes å®šç¾©å‡ºä¾†ï¼Œ  
ç…§è‘—å®˜ç¶²çš„ç¯„ä¾‹å°±å¯ä»¥ç”¢ç”Ÿ `/product/1`ã€`/product/2`ã€`/product/3` å°æ‡‰çš„ urlï¼Œ  
è‹¥é€²åˆ° `/product/4` å‰‡æœƒé¡¯ç¤º 404 ï¼Œå› ç‚º `Next` åœ¨ `build` çš„æ™‚å€™æ²’æœ‰ç”¢å‡º `/product/4` é€™å€‹ url ã€‚

```tsx
export function generateStaticParams() {
  return [{ id: '1' }, { id: '2' }, { id: '3' }]
}

// Three versions of this page will be statically generated
// using the `params` returned by `generateStaticParams`
// - /product/1
// - /product/2
// - /product/3
export default function Page({ params }: { params: { id: string } }) {
  const { id } = params
  // ...
}
```

## å¯¦ä½œ

### è¨­å®šæ–‡ç«  Tag

è¦è¨­å®šæ¯ä¸€ç¯‡æ–‡ç« çš„ Tag ï¼Œé¦–å…ˆéœ€è¦åœ¨ `contentlayer.config.js` å…§è¨­å®š `fields` ï¼Œ

```js:contentlayer.config.js showLineNumbers {17-23}
export const Post = defineDocumentType(() => ({
  name: 'Post',
  filePathPattern: `posts/**/*.mdx`,
  contentType: 'mdx',
  fields: {
    title: {
      type: 'string',
      required: true
    },
    description: {
      type: 'string'
    },
    date: {
      type: 'date',
      required: true
    },
    tags: {
      type: 'list',
      of: {
        type: 'string'
      },
      required: true
    }
  },
  // ...
}))
```

åœ¨ä¸€ç¯‡æ–‡ç« ä¸­ï¼ŒTag å¯ä»¥æœ‰è¤‡æ•¸å€‹ï¼Œæ‰€ä»¥æˆ‘å€‘å°‡ `type` è¨­å®šç‚º `list` [^2]ï¼Œç„¶å¾Œè£¡é¢çš„å€¼ç‚º `string`ï¼Œ
åœ¨æ–‡ç« è£¡é¢å°±å¯ä»¥è¨­å®šå°æ‡‰çš„ Tag ï¼Œ

```md showLineNumbers {5-7}
---
title: Tag cloud å¯¦ä½œ
description: å¯¦ä½œ Tag cloud çš„æ–¹å¼åŠéç¨‹ç´€éŒ„
date: '2023-10-04'
tags:
  - Next
  - DIY
---
```

### å»ºç«‹ Tag Page

æˆ‘æ‰€æ§‹æƒ³çš„æ˜¯ï¼Œé»æ“Šå´é‚Š Tag æœƒå°åˆ°å°æ‡‰çš„é é¢ï¼Œç„¶å¾Œé¡¯ç¤ºå°æ‡‰ Tag çš„æ‰€æœ‰æ–‡ç« ï¼Œ  
æ‰€ä»¥æˆ‘å€‘éœ€è¦å»ºç«‹å°æ‡‰çš„ Routesï¼Œè¨­å®šæ–¹å¼å¯åƒè€ƒ [pages-and-layouts](https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts)ï¼Œ

```
app
â”œâ”€ tag
|   â””â”€ [tag]
|        â””â”€ page.tsx
```

é€™æ¨£æ‰€ç”¢ç”Ÿçš„ url å°±æœƒæ˜¯ `/tag/[tag]`ã€‚

```tsx:tag/[tag]/Page.tsx showLineNumbers {2, 11-13}
import Link from 'next/link'
import { allPosts } from '@/.contentlayer/generated'
import TagCloud from '@/components/tag-cloud'

interface TagProps {
  params: {
    tag: string
  }
}

export async function generateStaticParams(): Promise<TagProps['params'][]> {
  return allPosts.flatMap((post) => post.tags).map((tag) => ({ tag }))
}

// ...
```

å†ä¾†æˆ‘å€‘å°±åœ¨ page.tsx ä¸­åˆ©ç”¨å‰é¢æåˆ°çš„ `generateStaticParams`ï¼Œä¾†è¨­å®š **ã€Œæ‰€æœ‰å¯èƒ½ã€** çš„è·¯ç”±ï¼Œ  
æˆ‘å€‘å…ˆå–å¾—æ¯ç¯‡æ–‡ç« æ‰€æœ‰çš„ `tags` ï¼Œå› ç‚ºæ¯ç¯‡æ–‡ç« çš„ `tags` åƒæ•¸éƒ½æœƒæ˜¯ `Array`ï¼Œæˆ‘å€‘éœ€è¦å…ˆä½¿ç”¨ `.map()` æ•´ç†æˆé€™æ¨£çš„é™£åˆ— `[['a', 'b'], ['c', 'd']]` ï¼Œå†ä½¿ç”¨ `.flat()` é‡æ–°æ•´ç†æˆ `['a', 'b', 'c', 'd']` ï¼Œè€Œé€™å…©ä»¶äº‹æƒ…æœ‰æ›´ç°¡å–®çš„èªæ³• `.flatMap()` [Array.prototype.flatMap()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/flatMap) ã€‚

è¨­å®šå¥½ Routes å¾Œï¼Œåªè¦åœ¨ç¶²å€è¼¸å…¥éŒ¯èª¤çš„ tag å°±æœƒå°åˆ° 404 pageï¼Œä¾‹å¦‚ /tag/test ã€‚

### å»ºç«‹ Tag cloud Component

å…ƒä»¶çš„å…§å®¹å¾ˆç°¡å–®ï¼ŒæŠŠæ•´ç†å¥½çš„ `Tags` ç•¶ä½œ `props` å‚³é€²ä¾† ï¼Œç„¶å¾Œæ¸²æŸ“å‡ºä¾†ã€‚

```tsx:tag-cloud.tsx showLineNumbers
import Link from 'next/link'

type Props = {
  tags: string[]
  className: string
}

const TagCloud = ({ tags, className }: Props) => {
  return (
    <div className={`sticky top-18 ${className}`}>
      <p className='mb-5 text-lg font-semibold text-gray-900 transition-colors dark:text-gray-100'>
        Tags
      </p>
      <ul className='flex flex-wrap'>
        {tags.map((tag) => (
          <li key={tag} className='mr-2 mb-2'>
            <Link href={`tag/${tag}`}># {tag}</Link>
          </li>
        ))}
      </ul>
    </div>
  )
}

export default TagCloud
```

åœ¨å…©å€‹åœ°æ–¹æœƒéœ€è¦ç”¨åˆ°é€™å€‹ component ï¼Œä¸€å€‹æ˜¯æˆ‘å€‘å‰›å‰›å»ºç«‹å¥½çš„ Tag pageã€ä¸€å€‹æ˜¯æ–‡ç« ç¸½æ”¬ `app/page.tsx`ï¼Œå…ˆä¾†çœ‹ Tag pageã€‚

```tsx:tag/[tag]/Page.tsx showLineNumbers {4}
// ...

export default function TagPage({ params }: TagProps) {
  const tag = decodeURIComponent(params.tag)
  const tags = allPosts.reduce<string[]>((acc, post) => {
    post.tags.forEach((tag) => {
      if (!acc.includes(tag)) {
        acc.push(tag)
      }
    })
    return acc
  }, [])

  return (
    <>
      <h2 className='mb-6 font-bold text-center text-2xl'>
        Tag : <span>{tag}</span>
      </h2>
      <div className='flex items-start'>
        <ul className='space-y-10 pr-6 w-9/12'>
          {allPosts
            .filter((post) => post.tags.includes(tag))
            .map((post) => (
              <li className='py-1 pl-2 border-l-2 border-green' key={post._id}>
                <Link className='px-2 block space-y-2' href={post.slug}>
                  <h2 className='text-xl font-bold'>{post.title}</h2>
                  {post.description && (
                    <p className='text-sm'>{post.description}</p>
                  )}
                </Link>
              </li>
            ))}
        </ul>
        <TagCloud tags={tags} className={'w-3/12'} />
      </div>
    </>
  )
}
```

`params` æœƒè‡ªå‹•å¤¾å¸¶æˆ‘å€‘ä¸€é–‹å§‹è¨­å®šå¥½çš„ Routes ï¼Œ  
 `[tag]` å°±æ˜¯æˆ‘å€‘è¨­å®šå¥½çš„åƒæ•¸ï¼Œå¦‚æœæ”¹æˆ `[test]` å‰‡ `params` å…§å°±æœƒæ˜¯ params.test çš„åƒæ•¸ï¼Œ
è€Œé€™å€‹åƒæ•¸å°±æ˜¯ä¾†è‡ªç¶²å€ `/tag/[tag]` ï¼Œä¾‹å¦‚ç¶²å€æ˜¯ `/tag/123`ï¼Œ`params.tag` çš„å€¼å°±æ˜¯ **123**

```text showLineNumbers {3}
app
â”œâ”€ tag
|   â””â”€ [tag]
|        â””â”€ page.tsx
```

è€Œä½¿ç”¨ [`decodeURIComponent`](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/decodeURIComponent) æ˜¯å› ç‚ºç¶²å€è‹¥ä½¿ç”¨ä¸­æ–‡ï¼Œparams å‚³é€²ä¾†çš„å€¼æœƒè®Šæˆä¸­æ–‡å­—ç¬¦çš„ `Unicode`ï¼Œéœ€è¦è½‰æ›å›ä¾†æ­£å¸¸çš„ä¸­æ–‡å­—ã€‚

å‰©ä¸‹çš„å°±æ˜¯ä¾æ“š `params.tag` ç¯©é¸å‡ºå°æ‡‰ tag çš„æ–‡ç« ï¼Œä»¥åŠå°‡æ‰€æœ‰æ–‡ç« çš„ tag æ•´ç†æˆä¸é‡è¤‡å€¼çš„é™£åˆ—å‚³åˆ° TagCloud component ã€‚

è€Œæ–‡ç« ç¸½æ”¬ä¹Ÿæ˜¯å¤§åŒå°ç•°ï¼Œåªå·®åœ¨æˆ‘å€‘ä¸éœ€è¦ç¯©é¸æ–‡ç« ã€‚

```tsx
export default function Home() {
  const tags = allPosts.reduce<string[]>((acc, post) => {
    post.tags.forEach((tag) => {
      if (!acc.includes(tag)) {
        acc.push(tag)
      }
    })
    return acc
  }, [])

  return (
    <div className='flex items-start'>
      <ul className='space-y-10 pr-6 w-9/12'>
        {allPosts.map((post, index) => (
          <li className='py-1 pl-2 border-l-2 border-green' key={post._id}>
            <Link className='px-2 block space-y-2' href={post.slug}>
              <h2 className='text-xl font-bold'>{post.title}</h2>
              {post.description && (
                <p className='text-sm'>{post.description}</p>
              )}
            </Link>
          </li>
        ))}
      </ul>
      <TagCloud tags={tags} className={'w-3/12'} />
    </div>
  )
}
```

### å®Œæˆ

å®Œæˆå¾Œï¼Œå°±å¯ä»¥åœ¨é€™å…©å€‹é é¢çœ‹åˆ° Tag cloudï¼Œé»æ“Š Tag å¾Œå°±å¯ä»¥å°åˆ°å°æ‡‰çš„é é¢é¡¯ç¤ºæ–‡ç« åˆ—è¡¨ ğŸ‰

---

[^1]: è£œå……åƒè€ƒ [æ¢³ç†NextJS13ä¸¤ç§è·¯ç”±ä¸‹çš„ä¸åŒæ¸²æŸ“æ–¹å¼ï¼šSSGï¼ŒISRï¼ŒSSRï¼ŒRSC](https://cloud.tencent.com/developer/article/2321765?areaId=106005)
[^2]: [Field Types Reference](https://contentlayer.dev/docs/reference/source-files/field-types-defe41e9#list)
